---
title: "Some notes on git"
date: November 06, 2019
author: Martin Papenberg
---

### Merging

Merging means: collect the commits from one branch and put them into
the branch that I am currently working on -- not the other way around.

When working on a development branch that has to be merged into a 
master branch and -- for some stupid reason -- clean merging does not
work, use git merge with the option `ours` (when merging master into 
devel) or `theirs` (when merging devel into master).

```
$ git merge branch -X theirs
```

This is better than the option suggested by Github if a pull request 
fails and they suggest to resort to the command line; when following
their instructions, it may be necessary to resolve conflicts manually,
which is error prone.

See [here](https://stackoverflow.com/questions/13594344/force-git-to-always-choose-the-newer-version-during-a-merge)

### Stashing

[Stashing](https://git-scm.com/book/en/v1/Git-Tools-Stashing) is 
something different than staging; stashing can be done to not commit 
dirty changes, for example if we wish to switch to a different branch 
before we have finished our work. Staging is the more common process 
done via `git add`. Files can be stashed using `git stash` and retrieved
using `git stash pop`.

### Setting up a new branch

Simply via:

```
$ git branch newbranch
```

To switch the the new branch, do not use the `branch` command (according
to the help file, the `branch` command only lists, creates, or deletes 
branches), but the checkout command:

```
$ git checkout newbranch
```

A shortcut for both is:

```
git checkout -b newbranch
```

See [here](https://happygitwithr.com/git-branches.html)

If you have made changes in one branch but would like to work in the 
other branch, one option is stashing:

```
$ git stash
$ git checkout branch2
$ git stash pop
```

See [here](https://stackoverflow.com/questions/556923/how-do-i-merge-my-local-uncommitted-changes-into-another-git-branch)

[This 
source](https://happygitwithr.com/git-branches.html#switching-branches) 
discusses that a commit in the old branch resetting it later is a safer
option and (see below). 

### Undo the most recent commit

This command undoes the most recent commit but keeps the changes (that
are unstaged then):

```
$ git reset HEAD~
```

See [here](https://stackoverflow.com/questions/927358/how-do-i-undo-the-most-recent-local-commits-in-git)
and [here](https://git-scm.com/book/en/v2/Git-Tools-Reset-Demystified).

HEAD~ is the parent of head (i.e., our latest commit on the current 
branch)---the previous commit.

The following will undo the latest commit and remove all work done since
the last commit (danger territory).

```
$ git reset --hard HEAD~
```

### Removing an obsolete remote

When performing a merge pull request on Github (and afterwards deleting 
the obsolete devel branch there), the local repository will still 
believe that the branch exists remotely. Use the following commands to 
first remove the branch locally and then the reference to the remote 
branch:

```
$ git branch -d devel
$ git fetch --prune
```

The latter command removes the remote reference from the local 
repository.

### Creating a feature development branch from devel

```
$ git checkout -b feature develop
```

See [here](https://nvie.com/posts/a-successful-git-branching-model/)

### Using git diff when changes are already staged

Using `git diff myfile` does not work when the changes are already 
staged, but sometimes we still want to see the changes that have been
done since the most recent commit. This works:

```
$ git diff HEAD myfile
```

HEAD is usually the most recent commit on the branch we are working on,
the parent of our next commit (see 
[here](https://stackoverflow.com/questions/2304087/what-is-head-in-git)).

### Pull, fetch, and merge

[git: fetch and merge, donâ€™t pull](https://longair.net/blog/2009/04/16/git-fetch-and-merge/)


This post has a nice example of what to do when some commits go wrong 
and shoud be reverted.

### Showing commits

```
$ git log --pretty=oneline
```

### Setting an upstream

When I create a git repository locally and not on Github first and then
start pushing to a remote repository (such as Github), I have to 
configure git to know where to push. First, add the remote as described
[here](https://help.github.com/en/github/using-git/adding-a-remote):

```
$ git remote add origin https://github.com/user/repo.git
# Set a new remote

$ git remote -v
# Verify new remote
> origin  https://github.com/user/repo.git (fetch)
> origin  https://github.com/user/repo.git (push)
```

Then, make sure that pushing and pulling actually uses this remote by 
default, as described [here](https://stackoverflow.com/questions/6089294/why-do-i-need-to-do-set-upstream-all-the-time):

```
git push -u origin my_branch
```

---

Last updated: `r Sys.Date()`

### <a href="index.html">Back to the front page</a>

&nbsp;
