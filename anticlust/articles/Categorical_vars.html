<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using categorical variables with anticlustering • anticlust</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using categorical variables with anticlustering">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">anticlust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.9-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Best_practices.html">Some best practices for anticlustering</a>
    </li>
    <li>
      <a href="../articles/Categorical_vars.html">Using categorical variables with anticlustering</a>
    </li>
    <li>
      <a href="../articles/Speeding_up_anticlustering.html">Speeding up anticlustering</a>
    </li>
    <li>
      <a href="../articles/stimulus-selection.html">Using the R package anticlust for stimulus selection in experiments</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://m-py.github.io/anticlust-blog" class="external-link">Blog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/m-Py/anticlust/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using categorical variables with
anticlustering</h1>
                        <h4 data-toc-skip class="author">Martin
Papenberg</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/m-Py/anticlust/blob/HEAD/vignettes/Categorical_vars.Rmd" class="external-link"><code>vignettes/Categorical_vars.Rmd</code></a></small>
      <div class="hidden name"><code>Categorical_vars.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/m-Py/anticlust" class="external-link">anticlust</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette I explore two ways to incorporate categorical
variables with anticlustering. The main function of
<code>anticlust</code> is <code><a href="../reference/anticlustering.html">anticlustering()</a></code>, and it has an
argument <code>categories</code>. It can be used easily enough: We just
pass the numeric variables as first argument (<code>x</code>) and our
categorical variable(s) to <code>categories</code>. I will use the
penguin data set from the <code>palmerpenguins</code> package to
illustrate the usage:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="co"># First exclude cases with missing values</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Adelie  Torgersen           39.1          18.7               181        <span style="text-decoration: underline;">3</span>750</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Adelie  Torgersen           39.5          17.4               186        <span style="text-decoration: underline;">3</span>800</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Adelie  Torgersen           40.3          18                 195        <span style="text-decoration: underline;">3</span>250</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Adelie  Torgersen           36.7          19.3               193        <span style="text-decoration: underline;">3</span>450</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Adelie  Torgersen           39.3          20.6               190        <span style="text-decoration: underline;">3</span>650</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Adelie  Torgersen           38.9          17.8               181        <span style="text-decoration: underline;">3</span>625</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 333</span></span></code></pre></div>
<p>In the data set, each row represents a penguin, and the data set has
four numeric variables (bill_length_mm, bill_depth_mm,
flipper_length_mm, body_mass_g) and several categorical variables
(species, island, sex) as descriptions of the penguins.</p>
<p>Let’s call <code><a href="../reference/anticlustering.html">anticlustering()</a></code> to divide the 333 penguins
into 3 groups. We use the four the numeric variables as first argument
(i.e., the anticlustering objective is computed on the basis of the
numeric variables), and the penguins’ sex as categorical variable:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">numeric_vars</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bill_length_mm"</span>, <span class="st">"bill_depth_mm"</span>, <span class="st">"flipper_length_mm"</span>, <span class="st">"body_mass_g"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="va">numeric_vars</span>, </span>
<span>  K <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  categories <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">sex</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s check out how well our categorical variables are balanced:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     55   56</span></span>
<span><span class="co">#&gt;      2     55   56</span></span>
<span><span class="co">#&gt;      3     55   56</span></span></code></pre></div>
<p>A perfect split! Similarly, we could use the species as categorical
variable:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="va">numeric_vars</span>, </span>
<span>  K <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  categories <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">species</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;      1     49        22     40</span></span>
<span><span class="co">#&gt;      2     49        23     39</span></span>
<span><span class="co">#&gt;      3     48        23     40</span></span></code></pre></div>
<p>As good as it could be! Now, let’s use both categorical variables at
the same time:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="va">numeric_vars</span>, </span>
<span>  K <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  categories <span class="op">=</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     54   57</span></span>
<span><span class="co">#&gt;      2     56   55</span></span>
<span><span class="co">#&gt;      3     55   56</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span> </span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;      1     49        22     40</span></span>
<span><span class="co">#&gt;      2     49        23     39</span></span>
<span><span class="co">#&gt;      3     48        23     40</span></span></code></pre></div>
<p>The results for the sex variable are worse than previously when we
only considered one variable at a time. This is because when using
multiple variables with the <code>categories</code> argument, all
columns are “merged” into a single column, and each combination of sex /
species is treated as a separate category. Some information on the
original variables is lost, and the results may become less
optimal—while being still pretty okay here. Alas, using only the
<code>categories</code> argument, we cannot improve this balancing even
if a better split with regard to both categorical variables would be
possible.</p>
<div class="section level2">
<h2 id="categorical-variables-as-numeric-variables">Categorical variables as numeric variables<a class="anchor" aria-label="anchor" href="#categorical-variables-as-numeric-variables"></a>
</h2>
<p>A second possibility to incorporate categorical variables is to treat
them as numeric variables and use them as part of the first argument
<code>x</code>, which is used to compute the anticlustering objective
(e.g., the diversity or variance). This approach can lead to better
results when multiple categorical variables are available, and / or if
the group sizes are unequal. I discuss the approach by the example of
k-means anticlustering, but using the diversity objective is also
possible (in principle, any reasonable way to transform categorical
variables to pairwise dissimilarities would work).</p>
<p>To use categorical variables as part of the anticlustering objective,
we first generate a matrix of the categorical variables in binary
representation using the <code>anticlust</code> convenience function
<code><a href="../reference/categories_to_binary.html">categories_to_binary()</a></code>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Because k-means anticlustering optimizes
similarity with regard to means, k-means anticlustering applied to this
binary matrix will even out the proportion of each category in each
group (this is because the mean of a binary variable is the proportion
of <code>1</code>s in that variable).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/categories_to_binary.html">categories_to_binary</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># see ?categories_to_binary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">binary_categories</span><span class="op">)</span></span>
<span><span class="co">#&gt;   speciesAdelie speciesChinstrap speciesGentoo sexfemale sexmale</span></span>
<span><span class="co">#&gt; 1             1                0             0         0       1</span></span>
<span><span class="co">#&gt; 2             1                0             0         1       0</span></span>
<span><span class="co">#&gt; 3             1                0             0         1       0</span></span>
<span><span class="co">#&gt; 4             1                0             0         1       0</span></span>
<span><span class="co">#&gt; 5             1                0             0         0       1</span></span>
<span><span class="co">#&gt; 6             1                0             0         1       0</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="va">binary_categories</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"local-maximum"</span>, </span>
<span>  objective <span class="op">=</span> <span class="st">"variance"</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     55   56</span></span>
<span><span class="co">#&gt;      2     55   56</span></span>
<span><span class="co">#&gt;      3     55   56</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;      1     49        23     39</span></span>
<span><span class="co">#&gt;      2     49        22     40</span></span>
<span><span class="co">#&gt;      3     48        23     40</span></span></code></pre></div>
<p>The results are quite convincing. In particular, the penguins’ sex is
better balanced than previously when we used the argument
<code>categories</code>. If we have multiple categorical variables and /
or unequal-sized groups, it may be useful to try out the k-means
optimization version of including categorical variables, instead of
(only) using the <code>categories</code> argument. If we also wish to
ensure that the categorical variables <em>in their combination</em> are
balanced between groups (i.e., the proportion of the penguins’ sex is
roughly the same for each species in each group), we could set the
optional argument <code>use_combinations</code> of
<code><a href="../reference/categories_to_binary.html">categories_to_binary()</a></code> to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/categories_to_binary.html">categories_to_binary</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span>, use_combinations <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="va">binary_categories</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"local-maximum"</span>, </span>
<span>  objective <span class="op">=</span> <span class="st">"variance"</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     55   56</span></span>
<span><span class="co">#&gt;      2     55   56</span></span>
<span><span class="co">#&gt;      3     55   56</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span> </span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;      1     49        23     39</span></span>
<span><span class="co">#&gt;      2     49        22     40</span></span>
<span><span class="co">#&gt;      3     48        23     40</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt; , ,  = Adelie</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     24   25</span></span>
<span><span class="co">#&gt;      2     25   24</span></span>
<span><span class="co">#&gt;      3     24   24</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , ,  = Chinstrap</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     12   11</span></span>
<span><span class="co">#&gt;      2     11   11</span></span>
<span><span class="co">#&gt;      3     11   12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , ,  = Gentoo</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     19   20</span></span>
<span><span class="co">#&gt;      2     19   21</span></span>
<span><span class="co">#&gt;      3     20   20</span></span></code></pre></div>
<p>Note that we only evenly distributed the categorical variable between
groups and did not consider any numeric variables. Fortunately, also
considering the numeric variables is possible, and can we accomplish
that in two different ways:</p>
<ol style="list-style-type: lower-alpha">
<li>we first optimize similarity with regard to the categorical
variable(s) via k-means anticlustering, and then insert the resulting
group assignment as a “hard constraint” into
<code><a href="../reference/anticlustering.html">anticlustering()</a></code>
</li>
<li>we simultaneous optimize similarity with regard to numeric and
categorical variables</li>
</ol>
<p>We discuss both approaches in the following.</p>
<div class="section level3">
<h3 id="a--sequential-optimization">a. Sequential optimization<a class="anchor" aria-label="anchor" href="#a--sequential-optimization"></a>
</h3>
<p>We use the output vector <code>groups</code> of the previous call to
<code><a href="../reference/anticlustering.html">anticlustering()</a></code>—which convincingly balanced our
categorical variables—as input to the <code>K</code> argument in an
additional call to <code><a href="../reference/anticlustering.html">anticlustering()</a></code>. The
<code>groups</code> vector is used as the initial group assignment
before the anticlustering optimization starts. In this group assignment,
the categories are already well balanced. We additionally pass the two
categorical variables to <code>categories</code>, thus ensuring that the
balancing of the categorical variable is never changed throughout the
optimization process:<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="va">numeric_vars</span>,</span>
<span>  K <span class="op">=</span> <span class="va">groups</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"local-maximum"</span>,</span>
<span>  categories <span class="op">=</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     55   56</span></span>
<span><span class="co">#&gt;      2     55   56</span></span>
<span><span class="co">#&gt;      3     55   56</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;      1     49        23     39</span></span>
<span><span class="co">#&gt;      2     49        22     40</span></span>
<span><span class="co">#&gt;      3     48        23     40</span></span>
<span><span class="fu"><a href="../reference/mean_sd_tab.html">mean_sd_tab</a></span><span class="op">(</span><span class="va">numeric_vars</span>, <span class="va">final_groups</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bill_length_mm bill_depth_mm  flipper_length_mm body_mass_g       </span></span>
<span><span class="co">#&gt; 1 "43.99 (5.58)" "17.17 (1.96)" "201.00 (14.09)"  "4206.31 (811.03)"</span></span>
<span><span class="co">#&gt; 2 "43.99 (5.38)" "17.16 (1.98)" "201.00 (14.04)"  "4207.66 (803.24)"</span></span>
<span><span class="co">#&gt; 3 "44.00 (5.49)" "17.17 (1.98)" "200.90 (14.05)"  "4207.21 (808.66)"</span></span></code></pre></div>
<p>The results are convincing, both with regard to the numeric variables
and the categorical variables.</p>
</div>
<div class="section level3">
<h3 id="b--simultaneous-optimization">b. Simultaneous optimization<a class="anchor" aria-label="anchor" href="#b--simultaneous-optimization"></a>
</h3>
<p>We can simultaneously consider the numeric and categorical variables
in the optimization process. Note that this approach only works with the
k-means and k-plus objectives, because only k-means adequately deals
with the categorical variables (at least when using the approach
described here). Using the simultaneous approach, we just pass all
variables (representing binary categories and numeric variables) as a
single matrix to the first argument of <code><a href="../reference/anticlustering.html">anticlustering()</a></code>. Do
not use the <code>categories</code> argument here!</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">numeric_vars</span>, <span class="va">binary_categories</span><span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"local-maximum"</span>, </span>
<span>  objective <span class="op">=</span> <span class="st">"variance"</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     55   56</span></span>
<span><span class="co">#&gt;      2     55   56</span></span>
<span><span class="co">#&gt;      3     55   56</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;      1     49        23     39</span></span>
<span><span class="co">#&gt;      2     49        22     40</span></span>
<span><span class="co">#&gt;      3     48        23     40</span></span>
<span><span class="fu"><a href="../reference/mean_sd_tab.html">mean_sd_tab</a></span><span class="op">(</span><span class="va">numeric_vars</span>, <span class="va">final_groups</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bill_length_mm bill_depth_mm  flipper_length_mm body_mass_g       </span></span>
<span><span class="co">#&gt; 1 "44.00 (5.48)" "17.17 (1.96)" "200.96 (13.70)"  "4206.98 (828.22)"</span></span>
<span><span class="co">#&gt; 2 "43.99 (5.54)" "17.16 (1.94)" "200.96 (14.58)"  "4206.98 (803.28)"</span></span>
<span><span class="co">#&gt; 3 "43.99 (5.43)" "17.16 (2.02)" "200.97 (13.88)"  "4207.21 (791.01)"</span></span></code></pre></div>
<p>The following code extends the simultaneous optimization approach
towards k-plus anticlustering, which ensures that standard deviations as
well as means are similar between groups (and not only the means, which
is achieved via standard k-means anticlustering):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anticlustering.html">anticlustering</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/kplus_moment_variables.html">kplus_moment_variables</a></span><span class="op">(</span><span class="va">numeric_vars</span>, T <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="va">binary_categories</span><span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"local-maximum"</span>, </span>
<span>  objective <span class="op">=</span> <span class="st">"variance"</span>, </span>
<span>  repetitions <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups female male</span></span>
<span><span class="co">#&gt;      1     55   56</span></span>
<span><span class="co">#&gt;      2     55   56</span></span>
<span><span class="co">#&gt;      3     55   56</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;      1     49        23     39</span></span>
<span><span class="co">#&gt;      2     49        22     40</span></span>
<span><span class="co">#&gt;      3     48        23     40</span></span>
<span><span class="fu"><a href="../reference/mean_sd_tab.html">mean_sd_tab</a></span><span class="op">(</span><span class="va">numeric_vars</span>, <span class="va">final_groups</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bill_length_mm bill_depth_mm  flipper_length_mm body_mass_g       </span></span>
<span><span class="co">#&gt; 1 "44.00 (5.48)" "17.16 (1.98)" "200.97 (14.05)"  "4207.88 (807.64)"</span></span>
<span><span class="co">#&gt; 2 "43.99 (5.48)" "17.17 (1.98)" "200.97 (14.07)"  "4207.43 (807.94)"</span></span>
<span><span class="co">#&gt; 3 "43.99 (5.49)" "17.16 (1.97)" "200.95 (14.06)"  "4205.86 (807.37)"</span></span></code></pre></div>
<p>While we use <code>objective = "variance"</code>—indicating that the
k-means objective is used—this code actually performs k-plus
anticlustering because the first argument takes as input the augmented
k-plus variable matrix<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. We see that the standard deviations are
now also quite evenly matched between groups (which is unlike when using
standard k-means anticlustering).</p>
<p>In the end: You should try out the different approaches for dealing
with categorical variables and see which one works best for you!</p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Internally, <code><a href="../reference/categories_to_binary.html">categories_to_binary()</a></code> is
wrapper around the base <code>R</code> function
<code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Only elements that have the same value in
<code>categories</code> are exchanged between clusters throughout the
optimization algorithm, so the initial balancing of the categories is
never changed when the algorithm runs.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>This is how k-plus anticlustering actually works: It
reuses the k-means criterion but uses additional “k-plus” variables as
input. More information on the k-plus approach is given in the
documentation: <code><a href="../reference/kplus_moment_variables.html">?kplus_moment_variables</a></code> and
<code><a href="../reference/kplus_anticlustering.html">?kplus_anticlustering</a></code>.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin Papenberg.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
